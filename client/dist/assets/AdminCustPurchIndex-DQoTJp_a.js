import{r as o,c as T,j as e,G as a,d as f,T as h,m as X,S as Z}from"./index-CTTX9ijT.js";import{a as F}from"./axios-C6NQisi-.js";import{M as g,T as w,a as M,b as O,c as U,d as s,e as $,S as ee}from"./Search-CCLIb58Y.js";import{A as te}from"./AdminAddCustPurch-BgjVG6VL.js";import{T as y,S as se}from"./TextField-Dktkde7T.js";import{l as ne}from"./logo (1)-D-rUVK23.js";import{h as E}from"./moment-G82_0lEo.js";/* empty css                    */import{F as re}from"./OutlinedInput-C8Fn8aqk.js";import{P as le}from"./Pagination-D93ObAOZ.js";import{D as N,a as k,b as Y}from"./DialogContent-BtWOILlZ.js";const ae=({data:t,onClose:b})=>{const[A,j]=o.useState([]),[m,C]=o.useState([]),[c,W]=o.useState({cust_id:t?t.cust_id:"",pro_id:t?t.pro_id:"",quantity:t?t.quantity:"",price:t?t.price:"",payment_type:t?t.payment_type:"",advance:t?t.advance:"",balance:t?t.balance:"",total:t?t.total:""}),[l,D]=o.useState({cust_id:"",pro_id:"",quantity:"",price:"",payment_type:"",advance:"",balance:"",total:""});o.useEffect(()=>{F.get(`${T.apiUrl}/product/getProductData`).then(r=>{j(r.data)}).catch(r=>{console.log("Customer purchase data is not fetched.")})},[]),o.useEffect(()=>{F.get(`${T.apiUrl}/customer/getCustomerForAdmin`).then(r=>{C(r.data)}).catch(r=>{console.log("Customer data is not fetched.")})},[]);const S=(r,i)=>{i&&typeof i=="string"&&i.trim()},u=r=>{const{name:i,value:d}=r.target;let x={...c,[i]:d};if(i==="payment_type"&&d==="partial"){const v=parseFloat(x.total||0),P=parseFloat(x.advance||0);x.balance=(v-P).toFixed(2)}else if(i==="advance"){const v=parseFloat(x.total||0),P=parseFloat(d||0);x.balance=(v-P).toFixed(2)}else if(i==="quantity"||i==="price"){const v=parseFloat(x.quantity||0),P=parseFloat(x.price||0);x.total=(v*P).toFixed(2)}const _=S(i,d);W(x),D({...l,[i]:_})},I=r=>{r.preventDefault();let i={};if(Object.keys(c).forEach(d=>{const x=c[d],_=S(d,x);_&&(i=_)}),Object.keys(i).length>0){D(i);return}F.put(`${T.apiUrl}/cust_purch/updateCustPurch/${t.cust_purch_id}`,c).then(d=>{b()}).catch(d=>{console.log("Error:",d)})};return e.jsx("div",{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{select:!0,fullWidth:!0,name:"cust_id",label:"Select customer",onChange:u,value:c.cust_id,error:!!l.cust_id,helperText:l.cust_id,children:m.map(r=>e.jsx(g,{value:r.cust_id,children:r.cust_name},r.cust_id))})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{select:!0,fullWidth:!0,name:"pro_id",label:"Select Product Name",onChange:u,value:c.pro_id,error:!!l.pro_id,helperText:l.pro_id,children:A.map(r=>e.jsx(g,{value:r.pro_id,children:r.pro_name},r.pro_id))})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,name:"quantity",label:"Quantity",type:"number",onChange:u,value:c.quantity,error:!!l.quantity,helperText:l.quantity})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,name:"price",label:"Price",type:"number",onChange:u,value:c.price,error:!!l.price,helperText:l.price})}),e.jsx(a,{item:!0,xs:6,children:e.jsxs(y,{select:!0,fullWidth:!0,name:"payment_type",label:"Select Payment type",onChange:u,value:c.payment_type,error:!!l.payment_type,helperText:l.payment_type,children:[e.jsx(g,{value:"full",children:"Full Payment"}),e.jsx(g,{value:"partial",children:"Partial Payment"})]})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,name:"total",label:"Total",type:"number",onChange:u,value:c.total,error:!!l.total,helperText:l.total})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,name:"advance",label:"Amount",type:"number",onChange:u,value:c.advance,error:!!l.advance,helperText:l.advance})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,name:"balance",label:"Balance Amount",type:"number",onChange:u,value:c.balance,error:!!l.balance,helperText:l.balance})}),e.jsx(a,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(f,{onClick:I,children:"Submit"})})]})})},ie=(t,b)=>t*b/100,oe=({data:t,dueDate:b})=>{const j=parseFloat(t.price)||0,m=ie(j,18),C=j+m;return e.jsxs("div",{style:{fontFamily:"Arial, sans-serif",fontSize:"12px"},children:[e.jsx(h,{variant:"h4",align:"center",style:{marginBottom:"20px"},children:"Customer Purchase Invoice"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,display:"flex",justifyContent:"end",children:e.jsx("img",{src:ne,alt:"Company Logo",width:"100",height:"100"})}),e.jsxs(a,{item:!0,xs:4,children:[e.jsx(h,{variant:"h6",style:{fontWeight:"bold"},children:"From"}),e.jsx(h,{children:t.purch_address?t.purch_address:"Krishna Industries"}),e.jsx(h,{children:t.purch_address?"":"Peelamedu, Singanallur"}),e.jsx(h,{children:t.purch_address?"":"Coimbatore, 627757"})]}),e.jsxs(a,{item:!0,xs:4,children:[e.jsx(h,{variant:"h6",style:{fontWeight:"bold"},children:"To"}),e.jsx(h,{children:t.cust_name}),e.jsx(h,{children:t.cust_mobile}),e.jsx(h,{children:t.cust_email})]}),e.jsxs(a,{item:!0,xs:4,children:[e.jsxs(h,{variant:"h6",style:{display:"inline-block",marginRight:"20px"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Invoice Date    : "})," ",E().format("YYYY-MM-DD")]}),e.jsxs(h,{variant:"h6",style:{display:"inline-block",marginTop:"2px"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Due Date           :"})," ",E(b).format("YYYY-MM-DD")]})]})]}),e.jsx(w,{style:{marginTop:"20px"},children:e.jsxs(M,{children:[e.jsx(O,{children:e.jsxs(U,{children:[e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"S.No"}),e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"Product Name"}),e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"Description"}),e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"Quantity"}),e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"Price"}),e.jsx(s,{style:{border:"1px solid #ddd",fontWeight:"bold"},children:"Total"})]})}),e.jsx($,{children:e.jsxs(U,{children:[e.jsx(s,{style:{border:"1px solid #ddd"},children:"01"}),e.jsx(s,{style:{border:"1px solid #ddd"},children:t.pro_name}),e.jsx(s,{style:{border:"1px solid #ddd"},children:t.specification}),e.jsx(s,{style:{border:"1px solid #ddd"},children:t.quantity}),e.jsx(s,{style:{border:"1px solid #ddd"},children:j.toFixed(2)}),e.jsx(s,{style:{border:"1px solid #ddd"},children:C.toFixed(2)})]})})]})}),e.jsxs("div",{style:{marginTop:"20px",borderTop:"1px solid #ddd",textAlign:"right"},children:[e.jsxs(h,{className:"mt-2",variant:"h6",children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Price"})," : ",j.toFixed(2)]}),e.jsxs(h,{className:"mt-2",variant:"h6",children:[e.jsx("span",{style:{fontWeight:"bold"},children:"GST 18%"})," : ",m.toFixed(2)]}),e.jsxs(h,{className:"mt-2",variant:"h6",children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Total"})," : ",C.toFixed(2)]})]})]})},be=()=>{const[t,b]=o.useState([]),[A,j]=o.useState([]),[m,C]=o.useState(5),[c,W]=o.useState(1),[l,D]=o.useState(!1),[S,u]=o.useState(!1),[I,r]=o.useState(!1),[i,d]=o.useState(!1),[x,_]=o.useState([]),[v,P]=o.useState(),[B,R]=o.useState();o.useEffect(()=>{F.get(`${T.apiUrl}/cust_purch/getCustPurchDataForAdmin`).then(n=>{b(n.data),j(n.data)}).catch(n=>{console.log("Customer purchase data is not fetched.")})},[l,S,I]);const G=n=>{const p=t.find(q=>q.cust_purch_id===n);p&&(_(p),u(!0))},Q=n=>{P(n),r(!0)},z=()=>{F.delete(`${T.apiUrl}/cust_purch/deleteCustPurch/${v}`).then(n=>{r(!1)}).catch(n=>{console.log("Error deleting data. Please try again later.")})},L=n=>{const p=t.find(q=>q.cust_purch_id===n);p&&(R(p),d(!0))},H=n=>{const p=parseInt(n.target.value,10);p===1?(C(t.length),W(1)):(C(p),W(1))},K=(c-1)*m,V=c*m,J=A.slice(K,V);return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Index"}),e.jsxs(a,{container:!0,spacing:2,className:"mt-3",children:[e.jsx(a,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(f,{onClick:()=>D(!0),children:"Purchase Product"})}),e.jsx(a,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(ee,{data:t,setData:j})}),e.jsx(a,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(re,{children:e.jsxs(se,{value:m,onChange:H,children:[e.jsx(g,{value:5,children:"5 Per Page"}),e.jsx(g,{value:10,children:"10 Per Page"}),e.jsx(g,{value:15,children:"15 Per Page"}),e.jsx(g,{value:1,children:"All Per Page"})]})})})]}),e.jsx(w,{component:X,className:"mt-4",children:e.jsxs(M,{children:[e.jsx(O,{children:e.jsxs(U,{children:[e.jsx(s,{style:{fontWeight:"bold"},children:"S.No"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Customer Name"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Customer Mobile"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Customer Email"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Product Name"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Quantity"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Price"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Payment Type"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Advance"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Balance"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Total"}),e.jsx(s,{style:{fontWeight:"bold"},children:"Action"})]})}),e.jsx($,{children:J.map((n,p)=>e.jsxs(U,{children:[e.jsx(s,{children:p+1}),e.jsx(s,{children:n.cust_name}),e.jsx(s,{children:n.cust_mobile}),e.jsx(s,{children:n.cust_email}),e.jsx(s,{children:n.pro_name}),e.jsx(s,{children:n.quantity}),e.jsx(s,{children:n.price}),e.jsx(s,{children:n.payment_type}),e.jsx(s,{children:n.advance}),e.jsx(s,{children:n.balance}),e.jsx(s,{children:n.total}),e.jsxs(s,{children:[e.jsx(f,{onClick:()=>L(n.cust_purch_id),children:"Invoice"}),e.jsx(f,{onClick:()=>G(n.cust_purch_id),children:"Edit"}),e.jsx(f,{onClick:()=>Q(n.cust_purch_id),children:"Delete"})]})]},n.cust_purch_id))})]})}),e.jsx(a,{container:!0,spacing:2,display:"flex",justifyContent:"center",className:"mt-4",children:e.jsx(Z,{spacing:2,children:e.jsx(le,{count:Math.ceil(t.length/m),page:c,onChange:(n,p)=>W(p),size:"small",style:{cursor:"pointer","&:hover":{backgroundColor:"transparent"}}})})}),e.jsx(N,{open:l,onClose:()=>D(!1),children:e.jsx(k,{children:e.jsx(te,{onClose:()=>D(!1)})})}),e.jsx(N,{open:S,onClose:()=>u(!1),children:e.jsx(k,{children:e.jsx(ae,{data:x,onClose:()=>u(!1)})})}),e.jsxs(N,{open:I,onClose:()=>r(!1),children:[e.jsx(k,{children:e.jsx("h4",{children:"Are you sure you want to delete?"})}),e.jsxs(Y,{children:[e.jsx(f,{onClick:z,children:"Yes"}),e.jsx(f,{onClick:()=>r(!1),children:"No"})]})]}),e.jsxs(N,{open:i,onClose:()=>d(!1),children:[e.jsx(k,{children:e.jsx(oe,{data:B,onClose:()=>d(!1)})}),e.jsx(Y,{children:e.jsx(f,{onClick:()=>window.print(),children:"Print"})})]})]})};export{be as default};
